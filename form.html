<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>A humble cleaning form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  <script src="./js/components.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div id="root"></div>
  <script type="text/babel">

      const BOND_CLEAN = "6";

      class Container extends React.Component {

        render() {
          return (
            <div id="container">
              <CleaningForm />
            </div>
          );
        }

      }

      class CleaningForm extends React.Component {

        constructor(props) {
          super(props);
          this.state = {
            firstName: "",
            email: "",
            phoneNumber: "",
            bedrooms: "1",
            bathrooms: "1",
            frequency: "1",
            warnings: []
          };
        }

        onNameChange = (event) => {
          this.setState({
              firstName: event.target.value
          });
        };

        onEmailChange = (event) => {
          this.setState({
            email: event.target.value
          });
        };

        onNumberChange = (event) => {
          this.setState({
            phoneNumber: event.target.value
          });
        };

        onBedroomsChange = (event) => {
          this.setState({
            bedrooms: event.target.value
          });
        };

        onBathroomsChange = (event) => {
          this.setState({
            bathrooms: event.target.value
          });
        };

        onFrequencyChange = (event) => {
          this.setState({
            frequency: event.target.value
          });
        };

        handleSubmit = (event) => {
          this.onBookClick();
          event.preventDefault();
        };

        onBookClick = () => {

           /*
          // TODO: Fix up
          //window.location = "http://snapclean.com.au/booking-page/?frequency=2&phone=0455111222&first_name=Jared";

          if (this.state.frequency !== BOND_CLEAN) {

          } else {

          }
          */

          let warnings = [];

          if (this.state.firstName === "") {
            warnings.push("firstName");
          }

          if (this.state.phoneNumber === "") {
            warnings.push("phoneNumber");
          }

          if (this.state.email === "") {
            warnings.push("email");
          }

          if (warnings.length > 0) {
            this.setState({
              warnings: warnings
            });
            return;
          }

          // TODO: Uncomment
          //let newLocation = this.createRedirectLocation();
          //window.location = newLocation;

          fetch('https://script.google.com/macros/s/AKfycbwVLBJyzQmJexJsKopeMiy9athlJieCYgeRVOPJrHJmBNzLx7X4/exec', {
            method: 'post',
            body: JSON.stringify({
              firstName: this.state.firstName,
              email: this.state.email,
              phoneNumber: this.state.phoneNumber,
              frequency: this.state.frequency,
              bedrooms: this.state.bedrooms,
              bathrooms: this.state.bathrooms
            })
          }).then(response => response.text()).then(text => {
            console.log(text);
          });

        };

        // TODO: Need to account for bond cleaning
        createRedirectLocation = () => {
          return `http://snapclean.com.au/booking-page/?first_name=${this.state.firstName}&email=${this.state.email}&phone=${this.state.phoneNumber}&service_id=${this.state.bedrooms}&pricing_parameter[1]=${this.state.bathrooms}&frequency_id=${this.state.frequency}`;
        };

        getInputStyle = (name) => {
          if (this.state.warnings.indexOf(name) > - 1) {
            return {
              borderWidth: 2,
              borderColor: 'red'
            };
          } else {
            return {
              border: 'none'
            };
          }
        };

        render() {
          return (
            <div id="formContainer">
              <h1>Get a free quote in seconds</h1>
              <form onSubmit={this.handleSubmit}>
                <input type="text" style={this.getInputStyle("firstName")} value={this.state.firstName} onChange={this.onNameChange} placeholder="First Name" />
                <input type="text" style={this.getInputStyle("email")} value={this.state.email} onChange={this.onEmailChange} placeholder="Email" />
                <input type="text" style={this.getInputStyle("phoneNumber")} value={this.state.phoneNumber} onChange={this.onNumberChange}  placeholder="Phone Number" />
                <select value={this.state.bedrooms} onChange={this.onBedroomsChange}>
                  <option value="12">1 Bedroom</option>
                  <option value="2">2 Bedrooms</option>
                  <option value="8">3 Bedrooms</option>
                  <option value="9">4 Bedrooms</option>
                  <option value="5">5 Bedrooms</option>
                  <option value="6">6 Bedrooms</option>
                </select>
                <select value={this.state.bathrooms} onChange={this.onBathroomsChange}>
                  <option value="1">1 Bathroom</option>
                  <option value="2">2 Bathrooms</option>
                  <option value="3">3 Bathrooms</option>
                  <option value="4">4 Bathrooms</option>
                  <option value="5">5 Bathrooms</option>
                  <option value="6">6 Bathrooms</option>
                </select>
                <select value={this.state.frequency} onChange={this.onFrequencyChange}>
                  <option value="1">One Time</option>
                  <option value="4">Weekly</option>
                  <option value="3">Every 2 Weeks</option>
                  <option value="5">Every 3 Weeks</option>
                  <option value="2">Monthly</option>
                  <option value="6">Bond Clean/Move In Move Out</option>
                </select>
                <input id="submitButton" type="submit" value="BOOK"/>
              </form>
            </div>
          );
        }

      }

      ReactDOM.render(
        <Container />,
        document.getElementById('root')
      );

    </script>
</body>

</html>